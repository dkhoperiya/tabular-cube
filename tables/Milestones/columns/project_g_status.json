{
  "type": "calculated",
  "name": "project_g_status",
  "dataType": "int64",
  "isDataTypeInferred": true,
  "isHidden": true,
  "expression": [
    "VAR IsG6 = Milestones[Milestone] = \"[G6]\"",
    "VAR IsDone = Milestones[Works Complete]",
    "VAR Proj = Milestones[project_code]",
    "VAR DateG3 =",
    "    CALCULATE (",
    "        MAX ( Milestones[Plan Date] ),",
    "        FILTER (",
    "            Milestones,",
    "            Milestones[project_code] = Proj",
    "                && Milestones[Milestone] = \"[G3]\"",
    "                && Milestones[Plan Date] <= EARLIER ( Milestones[Plan Date] )",
    "        )",
    "    )",
    "VAR StatusG3 =",
    "    IF (",
    "        NOT ( ISBLANK ( DateG3 ) ),",
    "        CALCULATE (",
    "            FIRSTNONBLANK ( Milestones[Works Status], COUNTA ( Milestones[project_code] ) ),",
    "            FILTER (",
    "                Milestones,",
    "                Milestones[project_code] = proj",
    "                    && Milestones[Milestone] = \"[G3]\"",
    "                    && Milestones[Plan Date] = DateG3",
    "            )",
    "        )",
    "    )",
    "VAR DateG2 =",
    "    CALCULATE (",
    "        MAX ( Milestones[Plan Date] ),",
    "        FILTER (",
    "            Milestones,",
    "            Milestones[project_code] = Proj",
    "                && Milestones[Milestone] = \"[G2]\"",
    "                && Milestones[Plan Date]",
    "                    <= IF ( ISBLANK ( DateG3 ), EARLIER ( Milestones[Plan Date] ), DateG3 )",
    "        )",
    "    )",
    "VAR StatusG2 =",
    "    IF (",
    "        NOT ( ISBLANK ( DateG2 ) ),",
    "        CALCULATE (",
    "            FIRSTNONBLANK ( Milestones[Works Status], COUNTA ( Milestones[project_code] ) ),",
    "            FILTER (",
    "                Milestones,",
    "                Milestones[project_code] = proj",
    "                    && Milestones[Milestone] = \"[G2]\"",
    "                    && Milestones[Plan Date] = DateG2",
    "            )",
    "        )",
    "    )",
    "VAR DateG5 =",
    "    CALCULATE (",
    "        MAX ( Milestones[Plan Date] ),",
    "        FILTER (",
    "            Milestones,",
    "            Milestones[project_code] = Proj",
    "                && Milestones[Milestone] = \"[G5]\"",
    "                && Milestones[Plan Date] <= EARLIER ( Milestones[Plan Date] )",
    "        )",
    "    )",
    "VAR StatusG5 =",
    "    IF (",
    "        NOT ( ISBLANK ( DateG5 ) ),",
    "        CALCULATE (",
    "            FIRSTNONBLANK ( Milestones[Works Status], COUNTA ( Milestones[project_code] ) ),",
    "            FILTER (",
    "                Milestones,",
    "                Milestones[project_code] = proj",
    "                    && Milestones[Milestone] = \"[G5]\"",
    "                    && Milestones[Plan Date] = DateG5",
    "            )",
    "        )",
    "    )",
    "RETURN",
    "    IF (",
    "        IsG6,",
    "        IF (",
    "            IsDone,",
    "            6,",
    "            IF (",
    "                StatusG5 = \"Выполнено\",",
    "                5,",
    "                IF ( StatusG3 = \"Выполнено\", 3, IF ( StatusG2 = \"Выполнено\", 2, 0 ) )",
    "            )",
    "        )",
    "    )"
  ]
}