{
  "name": "Формула AM C&M or detailed",
  "expression": [
    "VAR allSum =",
    "    CALCULATE ( [FactIncomeMTSD до даты], 'Options'[Wip History Mode] = \"As Is\" )",
    "VAR komp1 =",
    "    CALCULATE (",
    "        [FactPrevActRMSProjectCosts до даты],",
    "        'Options'[Wip History Mode] = \"As Is\"",
    "    )",
    "VAR komp2 =",
    "    CALCULATE ( [FactPrevActMargin до даты], 'Options'[Wip History Mode] = \"As Is\" )",
    "VAR komp3 =",
    "    CALCULATE (",
    "        [FactPrevActOverheadCosts до даты],",
    "        'Options'[Wip History Mode] = \"As Is\"",
    "    )",
    "VAR komp4 =",
    "    CALCULATE (",
    "        [FactPrevActOtherExpenses до даты],",
    "        'Options'[Wip History Mode] = \"As Is\"",
    "    )",
    "VAR am =",
    "    CALCULATE ( [ФормулаAM_C&M], 'Options'[Wip History Mode] = \"As Is\" )",
    "VAR am_det =",
    "    CALCULATE ( [ФормулаAM_detailed], 'Options'[Wip History Mode] = \"As Is\" )",
    "VAR output =",
    "    IF (",
    "        allsum > 0",
    "            && komp1 = 0",
    "            && komp2 = 0",
    "            && komp3 = 0",
    "            && komp4 = 0,",
    "        am,",
    "        am_det",
    "    )",
    "VAR correction =",
    "    CALCULATE (",
    "        [WIP Project Value Open Period],",
    "        KEEPFILTERS ( 'WIP_ProjectMetricsHistory'[MeasureName] = \"Формула AM C&M or detailed\" )",
    "    )",
    "RETURN",
    "    output + correction"
  ],
  "formatString": "#,##0.00",
  "displayFolder": "16. WIP\\Метрики 2023"
}