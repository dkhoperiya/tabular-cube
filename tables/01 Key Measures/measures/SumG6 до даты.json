{
  "name": "SumG6 до даты",
  "expression": [
    "VAR maxDate =",
    "    MAX ( Dates[Date] )",
    "VAR startYear =",
    "    DATE ( 2022, 01, 01 )",
    "VAR ProjectsWithClosedG6 =",
    "    FILTER (",
    "        VALUES ( Projects[Project Code] ),",
    "        CALCULATE (",
    "            [Fact Act Sum G6],",
    "            KEEPFILTERS ( Milestones[Works Complete] ),",
    "            KEEPFILTERS ( Milestones[Plan Date] >= startYear ),",
    "            KEEPFILTERS ( BusinessUnits[Entity Code] = \"1\" ),",
    "            KEEPFILTERS ( Projects[WIPFrameworkId]",
    "                IN {",
    "                \"53D1E98D-8C70-4132-A710-BD4FDEE1AF50\",",
    "                \"C6B558FA-C262-46A5-BE43-9612294961D8\"",
    "            } ),",
    "            FILTER ( ALL ( Dates ), Dates[Date] <= maxDate && Dates[Date] >= startYear )",
    "        ) > 0",
    "    )",
    "VAR ProjectsWithOutClosedG6 =",
    "    FILTER (",
    "        VALUES ( Projects[Project Code] ),",
    "        CALCULATE (",
    "            [Fact Act Sum G6],",
    "            KEEPFILTERS ( Milestones[Works Complete] ),",
    "            KEEPFILTERS ( BusinessUnits[Entity Code] = \"1\" ),",
    "            KEEPFILTERS ( Milestones[Plan Date] >= startYear ),",
    "            KEEPFILTERS ( Projects[WIPFrameworkId]",
    "                IN {",
    "                \"53D1E98D-8C70-4132-A710-BD4FDEE1AF50\",",
    "                \"C6B558FA-C262-46A5-BE43-9612294961D8\"",
    "            } ),",
    "            FILTER ( ALL ( Dates ), Dates[Date] <= maxDate && Dates[Date] >= startYear )",
    "        ) = 0",
    "    )",
    "RETURN",
    "    CALCULATE (",
    "        [Fact Act Sum G6],",
    "        ProjectsWithClosedG6,",
    "        FILTER ( ALL ( Dates ), Dates[Date] <= maxDate && Dates[Date] >= startYear )",
    "    ) /*временно используем данные из черновиков wip актов, т.к. пока не приходят данные из 1С по реальным актам*/",
    "        + CALCULATE (",
    "            [WipActs Drafts Amount],",
    "            ProjectsWithOutClosedG6,",
    "            FILTER ( ALL ( Dates ), Dates[Date] >= startYear && Dates[Date] < maxDate )",
    "        )"
  ],
  "formatString": "#,##0.00",
  "displayFolder": "16. WIP",
  "detailRowsDefinition": {
    "expression": [
      "VAR maxDate =",
      "    MAX ( Dates[Date] )",
      "VAR startYear =",
      "    DATE ( 2022, 01, 01 )",
      "VAR ProjectsWithClosedG6 =",
      "    FILTER (",
      "        VALUES ( Projects[Project Code] ),",
      "        CALCULATE (",
      "            [Fact Act Sum G6],",
      "            KEEPFILTERS ( Milestones[Works Complete] ),",
      "            KEEPFILTERS ( Milestones[Plan Date] >= startYear ),",
      "            KEEPFILTERS ( BusinessUnits[Entity Code] = \"1\" ),",
      "            KEEPFILTERS ( Projects[WIPFrameworkId]",
      "                IN {",
      "                \"53D1E98D-8C70-4132-A710-BD4FDEE1AF50\",",
      "                \"C6B558FA-C262-46A5-BE43-9612294961D8\"",
      "            } )",
      "        ) > 0",
      "    )",
      "VAR ProjectsWithOutClosedG6 =",
      "    FILTER (",
      "        VALUES ( Projects[Project Code] ),",
      "        CALCULATE (",
      "            [Fact Act Sum G6],",
      "            KEEPFILTERS ( Milestones[Works Complete] ),",
      "            KEEPFILTERS ( Milestones[Plan Date] >= startYear ),",
      "            KEEPFILTERS ( BusinessUnits[Entity Code] = \"1\" ),",
      "            KEEPFILTERS ( Projects[WIPFrameworkId]",
      "                IN {",
      "                \"53D1E98D-8C70-4132-A710-BD4FDEE1AF50\",",
      "                \"C6B558FA-C262-46A5-BE43-9612294961D8\"",
      "            } )",
      "        ) = 0",
      "    )",
      "RETURN",
      "    ADDCOLUMNS (",
      "        ADDCOLUMNS (",
      "            VALUES ( Projects[Project] ),",
      "            \"_Fact Act Sum G6\",",
      "                CALCULATE (",
      "                    [Fact Act Sum G6],",
      "                    ProjectsWithClosedG6,",
      "                    FILTER ( ALL ( Dates ), Dates[Date] <= maxDate && Dates[Date] >= startYear )",
      "                ),",
      "            \"_WipActs Drafts Amount\",",
      "                CALCULATE (",
      "                    [WipActs Drafts Amount],",
      "                    ProjectsWithOutClosedG6,",
      "                    FILTER ( ALL ( Dates ), Dates[Date] >= startYear && Dates[Date] < maxDate )",
      "                )",
      "        ),",
      "        \"SumG6 до даты\", [_Fact Act Sum G6] + [_WipActs Drafts Amount]",
      "    )"
    ]
  }
}