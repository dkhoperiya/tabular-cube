{
  "name": "Plan Tribe Costs Subcontracts",
  "description": "Плановая сумма расходов трайба на субподряд. Сотрудники тарйба работают на проектах прочих трайбов (часы в ставках ФОТ)",
  "expression": [
    "VAR _BUDGET_VERSION =",
    "    IF (",
    "        HASONEVALUE ( 'Budget Rates Versions'[Budget Rates Version] ),",
    "        SELECTEDVALUE ( 'Budget Rates Versions'[Budget Rates Version] ),",
    "        \"Ставки RMS\"",
    "    )",
    "VAR _USE_PROJECT_PROBABILITY =",
    "    IF ( SELECTEDVALUE ( Options[Project Probability Mode] ) = \"Full\", 0, 1 )",
    "RETURN",
    "    CALCULATE (",
    "        SUM ( 'PlanHours_2lvl'[PlanHoursInFotRates] ),",
    "        KEEPFILTERS ( Projects[Project Category Code] <> \"10\" ),",
    "        KEEPFILTERS ( 'Projects'[incl_for_fin_plan] ),",
    "        KEEPFILTERS ( 'PlanHours_2lvl'[BudgetRates_Version] = _BUDGET_VERSION ),",
    "        KEEPFILTERS ( 'PlanHours_2lvl'[UseProjectProbability] = _USE_PROJECT_PROBABILITY )",
    "    )"
  ],
  "formatString": "#,0",
  "displayFolder": "02. Tribe\\02. Expenses\\01. Plan",
  "detailRowsDefinition": {
    "expression": [
      "VAR _BUDGET_VERSION =",
      "    IF (",
      "        HASONEVALUE ( 'Budget Rates Versions'[Budget Rates Version] ),",
      "        SELECTEDVALUE ( 'Budget Rates Versions'[Budget Rates Version] ),",
      "        \"Ставки RMS\"",
      "    )",
      "VAR _USE_PROJECT_PROBABILITY =",
      "    IF ( SELECTEDVALUE ( Options[Project Probability Mode] ) = \"Full\", 0, 1 )",
      "RETURN",
      "    SELECTCOLUMNS (",
      "        FILTER (",
      "            'PlanHours_2lvl',",
      "            RELATED ( 'Projects'[incl_for_fin_fact] )",
      "                && RELATED ( 'Projects'[Project Category Code] ) <> \"10\"",
      "                && 'PlanHours_2lvl'[UseProjectProbability] = _USE_PROJECT_PROBABILITY",
      "                && 'PlanHours_2lvl'[BudgetRates_Version] = _BUDGET_VERSION",
      "        ),",
      "        \"Project\", RELATED ( 'Projects'[Project] ),",
      "        \"Project Tribe\", RELATED ( 'Projects'[Project Tribe] ),",
      "        \"PM\", RELATED ( Projects[PM] ),",
      "        \"PO\", RELATED ( Projects[PO] ),",
      "        \"Resource Tribe\", RELATED ( 'Tribes'[Tribe] ),",
      "        \"BU\", 'PlanHours_2lvl'[BuCode],",
      "        \"Role\", RELATED ( 'Roles'[Role] ),",
      "        \"Competence\", RELATED ( 'Competences'[Competence] ),",
      "        \"Investment Project\", 'PlanHours_2lvl'[Investment_Project],",
      "        \"Investment Task\", 'PlanHours_2lvl'[Investment_Task],",
      "        \"Date\", RELATED ( Dates[Date] ),",
      "        \"Plan Hours in Fot Rates\", 'PlanHours_2lvl'[PlanHoursInFotRates]",
      "    )"
    ]
  }
}