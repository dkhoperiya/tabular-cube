{
  "name": "FactIndFotWoLeadersMTSD",
  "description": "Списания Диджитал без маржи без бигбоссов",
  "expression": [
    "VAR DateForFot =",
    "    DATE ( 2022, 07, 01 )",
    "",
    "VAR DateForUnitHead =",
    "    DATE ( 2023, 01, 01 )",
    "   ",
    "/*ФОТ по проектам с типом оплаты по ФОТ c 01.07.2022*/",
    "VAR x1 =",
    "    CALCULATE (",
    "        [TB_Amount], 'Options'[Wip History Mode] = \"As Is\",",
    "        KEEPFILTERS ( TeamBudgeting_Hours_Calculation[Calculation_TypeCode] IN { 1, 3 } ),",
    "        KEEPFILTERS ( TeamBudgeting_Hours_Calculation[IsRenormEnabled] = 1 ),",
    "        KEEPFILTERS ( BusinessUnits[Entity Code] = \"1\" ),",
    "        KEEPFILTERS ( Dates[Date] >= DateForFot )",
    "    )",
    "    ",
    "/*ФОТ по проектам с типом оплаты по ТС c 01.07.2022 до 01.01.2023 исключаем только биг-боссов*/    ",
    "VAR x2 =",
    "    CALCULATE (",
    "        [FactFotRub],",
    "        KEEPFILTERS ( BusinessUnits[Entity Code] IN { \"1\" } ),",
    "        KEEPFILTERS ( FactHours[IsRenormEnabled] = 0 ),",
    "        KEEPFILTERS ( Roles[RoleWorkAreaId] <> 2 ),",
    "        KEEPFILTERS ( Dates[Date] >= DateForFot ),",
    "        KEEPFILTERS ( Dates[Date] < DateForUnitHead )",
    "    )",
    "    ",
    "/*ФОТ по проектам с типом оплаты по ФОТ и ТС до 01.07.2022*/   ",
    "VAR x3 =",
    "    CALCULATE (",
    "        [FactFotRub],",
    "        KEEPFILTERS ( BusinessUnits[Entity Code] IN { \"1\" } ),",
    "        KEEPFILTERS ( FactHours[IsRenormEnabled] IN { 0, 1 } ),",
    "        KEEPFILTERS ( Dates[Date] < DateForFot )",
    "    )",
    "    ",
    "/*По проектам с типом оплаты по ТС с 01.01.2023 исключаем биг-боссов и юнитхедов*/    ",
    "VAR x4 =",
    "    CALCULATE (",
    "        [FactFotRub],",
    "        KEEPFILTERS ( BusinessUnits[Entity Code] IN { \"1\" } ),",
    "        KEEPFILTERS ( FactHours[IsRenormEnabled] = 0 ),",
    "        KEEPFILTERS ( NOT Roles[RoleWorkAreaId] IN { 2, 3 } ),",
    "        KEEPFILTERS ( Dates[Date] >= DateForUnitHead )",
    "    )",
    "    ",
    "RETURN",
    "    x1 + x2 + x3 + x4",
    "        + CALCULATE (",
    "            [WIP Project Value Open Period],",
    "            KEEPFILTERS ( 'WIP_ProjectMetricsHistory'[MeasureName] = \"FactIndFotWoLeadersMTSD\" )",
    "        )"
  ],
  "formatString": "#,##0.00",
  "displayFolder": "16. WIP\\Метрики перенормализации\\Списания Диджитал с маржой и ББ",
  "detailRowsDefinition": {
    "expression": [
      "VAR DateForFot =",
      "    DATE ( 2022, 07, 01 )",
      "VAR DateForUnitHead =",
      "    DATE ( 2023, 01, 01 ) /*ФОТ по проектам с типом оплаты по ФОТ c 01.07.2022*/",
      "VAR x1 =",
      "    CALCULATE (",
      "        [TB_Amount],'Options'[Wip History Mode] = \"As Is\",",
      "        KEEPFILTERS ( TeamBudgeting_Hours_Calculation[Calculation_TypeCode] IN { 1, 3 } ),",
      "        KEEPFILTERS ( TeamBudgeting_Hours_Calculation[IsRenormEnabled] = 1 ),",
      "        KEEPFILTERS ( BusinessUnits[Entity Code] = \"1\" ),",
      "        KEEPFILTERS ( Dates[Date] >= DateForFot )",
      "    ) /*ФОТ по проектам с типом оплаты по ТС c 01.07.2022 до 01.01.2023 исключаем только биг-боссов*/",
      "VAR x2 =",
      "    CALCULATE (",
      "        [FactFotRub],",
      "        KEEPFILTERS ( BusinessUnits[Entity Code] IN { \"1\" } ),",
      "        KEEPFILTERS ( FactHours[IsRenormEnabled] = 0 ),",
      "        KEEPFILTERS ( Roles[RoleWorkAreaId] <> 2 ),",
      "        KEEPFILTERS ( Dates[Date] >= DateForFot ),",
      "        KEEPFILTERS ( Dates[Date] < DateForUnitHead )",
      "    ) /*ФОТ по проектам с типом оплаты по ФОТ и ТС до 01.07.2022*/",
      "VAR x3 =",
      "    CALCULATE (",
      "        [FactFotRub],",
      "        KEEPFILTERS ( BusinessUnits[Entity Code] IN { \"1\" } ),",
      "        KEEPFILTERS ( FactHours[IsRenormEnabled] IN { 0, 1 } ),",
      "        KEEPFILTERS ( Dates[Date] < DateForFot )",
      "    ) /*По проектам с типом оплаты по ТС с 01.01.2023 исключаем биг-боссов и юнитхедов*/",
      "VAR x4 =",
      "    CALCULATE (",
      "        [FactFotRub],",
      "        KEEPFILTERS ( BusinessUnits[Entity Code] IN { \"1\" } ),",
      "        KEEPFILTERS ( FactHours[IsRenormEnabled] = 0 ),",
      "        KEEPFILTERS ( NOT Roles[RoleWorkAreaId] IN { 2, 3 } ),",
      "        KEEPFILTERS ( Dates[Date] >= DateForUnitHead )",
      "    )",
      "VAR x5 =  CALCULATE (",
      "            [WIP Project Value Open Period],",
      "            KEEPFILTERS ( 'WIP_ProjectMetricsHistory'[MeasureName] = \"FactIndFotWoLeadersMTSD\" )",
      "        )",
      "RETURN",
      "    ROW (",
      "        \"FotProjectsAfterRenormEpoch\", x1,",
      "        \"TsProjects_2022\", x2,",
      "        \"AllProjectsBeforeRenormEpoch\", x3,",
      "        \"TsProjectsSince_2023\", x4,",
      "        \"Correction\", x5,",
      "        \"FactIndFOTwoLeadersMTSD\",",
      "            x1 + x2 + x3 + x4 + x5",
      "    )"
    ]
  }
}