{
  "name": "Project Capacity Fot Rates",
  "expression": [
    "VAR BudgetRatesVersion =",
    "    IF (",
    "        HASONEVALUE ( 'Budget Rates Versions'[Budget Rates Version] ),",
    "        SELECTEDVALUE ( 'Budget Rates Versions'[Budget Rates Version] ),",
    "        \"Ставки RMS\"",
    "    )",
    "RETURN",
    "    SUMX (",
    "        VALUES ( Dates[Year] ),",
    "        VAR _mon_list =",
    "            VALUES ( Dates[MonthID] )",
    "        VAR _fot_in_year =",
    "            CALCULATE (",
    "                [Tribe Capacity Fot Rates],",
    "                ALL ( Dates ),",
    "                KEEPFILTERS ( Dates[Year] = EARLIER ( Dates[Year] ) )",
    "            )",
    "        VAR _mon_count =",
    "            CALCULATE (",
    "                DISTINCTCOUNT ( Dates[MonthID] ),",
    "                ALL ( Dates ),",
    "                KEEPFILTERS ( Dates[Year] = EARLIER ( Dates[Year] ) ),",
    "                _mon_list",
    "            )",
    "        RETURN",
    "            SUMX (",
    "                CALCULATETABLE (",
    "                    project_capacity_allocation,",
    "                    TREATAS (",
    "                        VALUES ( Tribes[Tribe Code] ),",
    "                        project_capacity_allocation[project_tribe_code]",
    "                    ),",
    "                    KEEPFILTERS ( project_capacity_allocation[Year] = EARLIER ( Dates[Year] ) ),",
    "                    KEEPFILTERS ( project_capacity_allocation[Budget Rates Version] = BudgetRatesVersion )",
    "                ),",
    "                project_capacity_allocation[ProjectGM_Share] * _mon_count",
    "                    * CALCULATE (",
    "                        [Tribe Capacity Fot Rates],",
    "                        ALL ( Dates ),",
    "                        KEEPFILTERS ( Dates[Year] = EARLIER ( Dates[Year] ) ),",
    "                        KEEPFILTERS (",
    "                            Tribes[Tribe Code] = EARLIER ( project_capacity_allocation[project_tribe_code] )",
    "                        )",
    "                    ) / 12",
    "            )",
    "    )"
  ],
  "formatString": "#,0",
  "displayFolder": "04. Capacity",
  "detailRowsDefinition": {
    "expression": [
      "VAR BudgetRatesVersion =",
      "   IF (",
      "        HASONEVALUE ( 'Budget Rates Versions'[Budget Rates Version] ),",
      "        SELECTEDVALUE ( 'Budget Rates Versions'[Budget Rates Version] ),",
      "        \"Ставки RMS\"",
      "    )",
      "RETURN",
      "    SELECTCOLUMNS (",
      "        ADDCOLUMNS (",
      "            CALCULATETABLE (",
      "                project_capacity_allocation,",
      "                TREATAS (",
      "                    VALUES ( Tribes[Tribe Code] ),",
      "                    project_capacity_allocation[project_tribe_code]",
      "                ),",
      "                TREATAS ( VALUES ( Dates[Year] ), project_capacity_allocation[Year] ),",
      "                KEEPFILTERS ( project_capacity_allocation[Budget Rates Version] = BudgetRatesVersion )",
      "            ),",
      "            \"Project\", LOOKUPVALUE (",
      "                Projects[Project],",
      "                projects[Project Code], project_capacity_allocation[project_code]",
      "            ),",
      "            \"Tribe\", LOOKUPVALUE (",
      "                Tribes[Tribe],",
      "                Tribes[Tribe Code], project_capacity_allocation[project_tribe_code]",
      "            )",
      "        ),",
      "        \"Year\", [Year],",
      "        \"Project\", [Project],",
      "        \"Tribe\", [Tribe],",
      "        \"BudgetRatesVersion\", BudgetRatesVersion,",
      "        \"Project Plan Revenue\", project_capacity_allocation[PlanActSumG6],",
      "        \"Project Plan Transfer Cost of Works\", project_capacity_allocation[PlanTransferCostOfWorks],",
      "        \"Project Plan Resold Expenses\", project_capacity_allocation[PlanResoldExp],",
      "        \"Project Plan Net Revenue\", project_capacity_allocation[ProjectGM],",
      "        \"Tribe-Year Plan Net Revenue\", project_capacity_allocation[TribeYearProjectGM],",
      "        \"Project Net Revenue Share\", project_capacity_allocation[ProjectGM_Share],",
      "        \"Capacity FOT Rates\", CALCULATE ( [Tribe Capacity Fot Rates] ),",
      "        \"Project FOT by Capacity\", CALCULATE ( [Tribe Capacity Fot Rates] ) * project_capacity_allocation[ProjectGM_Share]",
      "    )"
    ]
  }
}