{
  "name": "Dismissals",
  "expression": [
    "/* Массив (таблица) выбранных дат */    ",
    "VAR selectedDates = ",
    "    CALCULATETABLE (",
    "        VALUES( Dates[Date] )",
    "    )",
    "       ",
    "/* Таблица сотрудников, у которых в результате последнего движения за период баланс равен 0 - уволен без возвращения */",
    "VAR zeroBalancedEmployees =",
    "    FILTER (",
    "        EmployeeMovements,",
    "        VAR MaxDate =",
    "            CALCULATE (",
    "                MAX ( EmployeeMovements[Date] ),",
    "                ALLEXCEPT ( EmployeeMovements, EmployeeMovements[EmployeeCode] ),",
    "                selectedDates",
    "            )",
    "        RETURN",
    "            CALCULATE (",
    "                MAX ( EmployeeMovements[Balance] ),",
    "                FILTER (",
    "                    ALLEXCEPT ( EmployeeMovements, EmployeeMovements[EmployeeCode] ),",
    "                    EmployeeMovements[Date] = MaxDate",
    "                )",
    "            ) = 0",
    "    ) ",
    "    ",
    "/* Таблица уволенных сотрудников за отчетный период*/",
    "VAR firedEmployees =",
    "    CALCULATETABLE (",
    "        EmployeeMovements,",
    "        selectedDates,",
    "        zeroBalancedEmployees,",
    "        EmployeeMovements[Action] = \"Dismissal\",",
    "        Employees[Trainee] = \"No\", -- Не стажер",
    "        Employees[AssigmentCombinationStatus] = \"Основное назначение\", -- Не совместитель",
    "        Employees[AssigmentTypeName] = \"STUFF\" -- Штатный сотрудник",
    "    )",
    "    ",
    "/* Таблица переведенных не в IT подразделения сотрудников за отчетный период */",
    "VAR noITTransferedEmployees = ",
    "    CALCULATETABLE(",
    "        EmployeeMovements,",
    "        selectedDates,",
    "        EmployeeMovements[Action] = \"Internal Transfer\",",
    "        SEARCH(\"Перевод в не IT подразделение\", EmployeeMovements[Description], 1, 0) > 0,",
    "        Employees[Trainee] = \"No\", -- Не стажер",
    "        Employees[AssigmentCombinationStatus] = \"Основное назначение\", -- Не совместитель",
    "        Employees[AssigmentTypeName] = \"STUFF\" -- Штатный сотрудник",
    "    )",
    "",
    "/* Количество уволенных сотрудников за выбранный период */",
    "VAR countFiredEmployees =",
    "    COUNTROWS(firedEmployees) + COUNTROWS(noITTransferedEmployees)",
    "    ",
    "RETURN ",
    "    countFiredEmployees"
  ],
  "formatString": "#,##0.0",
  "displayFolder": "09. HR"
}