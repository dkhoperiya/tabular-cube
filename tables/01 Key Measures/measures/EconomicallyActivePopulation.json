{
  "name": "EconomicallyActivePopulation",
  "expression": [
    "/* Текущий день */",
    "VAR currentDay = TODAY()",
    "",
    "/* Текущий месяц */",
    "VAR currentMonth = MONTH( TODAY() )",
    "",
    "/* Текущий год */",
    "VAR currentYear = YEAR( TODAY() )",
    "",
    "/* Массив (таблица) выбранных дат (последнии дни месяцев) */",
    "VAR selectedEndOfMonthDates =",
    "    CALCULATETABLE (",
    "        VALUES ( Dates[Date] ),",
    "        KEEPFILTERS(",
    "            IF(",
    "                MONTH( Dates[Date] ) = currentMonth && YEAR( Dates[Date] ) = currentYear, -- Если открытый период",
    "                Dates[Date] = currentDay,",
    "                Dates[Date] = EOMONTH( Dates[Date], 0 )",
    "            )",
    "        )",
    "    )",
    "",
    "/* Количество выбранных месяцев */",
    "VAR countSelectedMonth = ",
    "    COUNTROWS(selectedEndOfMonthDates)",
    "    ",
    "/* Таблица активных сотрудников */",
    "VAR activeEmployees =",
    "    CALCULATETABLE(",
    "        FILTER (",
    "            Capacity,",
    "            Capacity[StatusCode] = 10",
    "                && Capacity[AssigmentCombinationStatus] = \"Основное назначение\"",
    "                && Capacity[AssigmentTypeName] = \"STUFF\"",
    "                && Capacity[EmploymentType] <> \"Стажер\"",
    "        ),",
    "        selectedEndOfMonthDates",
    "    )",
    "  ",
    "/* Среднее ЭАЧ за период */",
    "VAR averageActiveEmployeesInPeriod =",
    "    CALCULATE (",
    "        DIVIDE ( COUNT ( Capacity[EmployeeCode] ), countSelectedMonth ),",
    "        activeEmployees,",
    "        selectedEndOfMonthDates",
    "    )",
    "    ",
    "",
    "RETURN ",
    "    averageActiveEmployeesInPeriod"
  ],
  "formatString": "#,##0",
  "displayFolder": "09. HR"
}