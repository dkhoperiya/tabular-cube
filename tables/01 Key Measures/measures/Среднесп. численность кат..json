{
  "name": "Среднесп. численность кат.",
  "expression": [
    "VAR _MAXDATE =",
    "    MAX ( Dates[Date] )",
    "VAR _MAX_ITER =",
    "    CALCULATE (",
    "        MAX ( ImportantEmployee[Iteration] ),",
    "        KEEPFILTERS ( 'ImportantEmployee'[Start Date] <= _MAXDATE ),",
    "        KEEPFILTERS (",
    "            'ImportantEmployee'[Finish Date] >= _MAXDATE",
    "                || ISBLANK ( 'ImportantEmployee'[Finish Date] )",
    "        )",
    "    )",
    "VAR _EMPL_CNT_PREV_ITER =",
    "    CALCULATE (",
    "        COUNTA ( 'ImportantEmployee'[Employee Code] ),",
    "        KEEPFILTERS ( ImportantEmployee[Iteration] = _MAX_ITER - 1 ),",
    "        TREATAS ( VALUES ( Tribes[Tribe] ), Employees[Employee Tribe Current] ),",
    "        TREATAS ( VALUES ( BusinessUnits[BU Code] ), Employees[Employee Bu Code] ),",
    "        TREATAS ( VALUES ( 'EmployeeAgeRanges'[ID] ), 'Employees'[Age Range ID] ),",
    "        TREATAS ( VALUES ( 'EmployeeWorkTermRanges'[ID] ), 'Employees'[Work Term ID] )",
    "    )",
    "VAR _EMPL_CNT_CUR_ITER =",
    "    CALCULATE (",
    "        COUNTA ( 'ImportantEmployee'[Employee Code] ),",
    "        KEEPFILTERS ( ImportantEmployee[Iteration] = _MAX_ITER ),",
    "        TREATAS ( VALUES ( Tribes[Tribe] ), Employees[Employee Tribe Current] ),",
    "        TREATAS ( VALUES ( BusinessUnits[BU Code] ), Employees[Employee Bu Code] ),",
    "        TREATAS ( VALUES ( 'EmployeeAgeRanges'[ID] ), 'Employees'[Age Range ID] ),",
    "        TREATAS ( VALUES ( 'EmployeeWorkTermRanges'[ID] ), 'Employees'[Work Term ID] )",
    "    )",
    "RETURN",
    "    IF (",
    "        ISBLANK ( _EMPL_CNT_PREV_ITER ),",
    "        _EMPL_CNT_CUR_ITER,",
    "        DIVIDE ( _EMPL_CNT_PREV_ITER + _EMPL_CNT_CUR_ITER, 2 )",
    "    )"
  ],
  "formatString": "#,##0",
  "displayFolder": "09. HR\\02. HR - метрики\\02. По категорям персонала",
  "detailRowsDefinition": {
    "expression": "CALCULATETABLE ( 'ImportantEmployee' )"
  }
}