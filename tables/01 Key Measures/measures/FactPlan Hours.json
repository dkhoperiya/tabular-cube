{
  "name": "FactPlan Hours",
  "description": "Факт план трудозатрат в чч. Факт берется до конца предыдущего месяца, план - начиная с текущего месяца",
  "expression": [
    "VAR d2 =",
    "    YEAR ( TODAY () ) * 10000",
    "        + MONTH ( TODAY () ) * 100 + 1",
    "RETURN",
    "    CALCULATE ( [fact hours], KEEPFILTERS ( 'FactHours'[DateKey] < d2 ) )",
    "        + CALCULATE ( [Plan Hours], KEEPFILTERS ( 'PlanHours'[DateKey] >= d2 ) )"
  ],
  "formatString": "#,0",
  "displayFolder": "03. Hours\\03. Forecast",
  "detailRowsDefinition": {
    "expression": [
      "VAR d2 =",
      "    YEAR ( TODAY () ) * 10000",
      "        + MONTH ( TODAY () ) * 100 + 1",
      "RETURN",
      "    UNION (",
      "        CALCULATETABLE (",
      "            SELECTCOLUMNS (",
      "                DETAILROWS ( [Plan Hours] ),",
      "                \"Project\", [Project],",
      "                \"Resource Tribe\", [Plan Resource Tribe],",
      "                \"Project Tribe\", [Project Tribe],",
      "                \"Role\", [Role],",
      "                \"Competence\", [Competence],",
      "                \"BusinessUnit\", [BU],",
      "                \"Date\", [Date],",
      "                \"Fot Rate\", [Fot Rate],",
      "                \"Transfer Rate\", [Transfer Rate],",
      "                \"Hours\", [Plan Hours],",
      "                \"PlanOrFact\", \"Plan\"",
      "            ),",
      "            KEEPFILTERS ( 'PlanHours'[DateKey] >= d2 )",
      "        ),",
      "        CALCULATETABLE (",
      "            SELECTCOLUMNS (",
      "                DETAILROWS ( [Fact Hours] ),",
      "                \"Project\", [Project],",
      "                \"Resource Tribe\", [Employee Tribe],",
      "                \"Project Tribe\", [Project Tribe],",
      "                \"Role\", [Role],",
      "                \"Competence\", [Competence],",
      "                \"BusinessUnit\", [BU],",
      "                \"Date\", [Date],",
      "                \"Fot Rate\", [Fot Rate],",
      "                \"Transfer Rate\", [Transfer Rate],",
      "                \"Hours\", [Fact Hours],",
      "                \"PlanOrFact\", \"Fact\"",
      "            ),",
      "            KEEPFILTERS ( 'FactHours'[DateKey] < d2 )",
      "        )",
      "    )"
    ]
  }
}